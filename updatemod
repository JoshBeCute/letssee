@echo off
setlocal enabledelayedexpansion

:: Define the Minecraft mods directory
set "modsDir=%appdata%\.minecraft\mods"

:: Ensure the mods directory exists
if not exist "%modsDir%" mkdir "%modsDir%"

:: Files to be deleted (with exact filenames as downloaded)
set "deleteFiles=PuzzlesLib-v21.1.3-1.21.1-Fabric.jar fabric-api-0.103.0+1.21.1.jar"

echo Checking for files to delete...

:: Loop through the files to delete them if they exist
for %%F in (%deleteFiles%) do (
    echo Checking if file %%F exists in %modsDir%...
    if exist "%modsDir%\%%F" (
        echo Deleting %%F...
        del "%modsDir%\%%F"
    ) else (
        echo %%F not found.
    )
)

:: URL of the file containing the list of mod download links
set "listUrl=https://raw.githubusercontent.com/JoshBeCute/letssee/main/modsplayer"

:: Download the list of URLs from the remote file
set "listFile=%temp%\mods_list.txt"
curl -s -o "%listFile%" "%listUrl%"

:: Check if the list file was downloaded correctly
if not exist "%listFile%" (
    echo Failed to download the list of mod URLs.
    exit /b 1
)

:: Read each line from the list file and download the corresponding file
for /f "usebackq tokens=*" %%A in ("%listFile%") do (
    set "url=%%A"
    set "filename=%%~nxA"

    :: Skip empty lines
    if not "!url!"=="" (
        :: Extract filename from URL
        for /f "tokens=*" %%B in ("!url!") do set "filename=%%~nxB"
        
        :: Check if the file already exists
        if not exist "%modsDir%\!filename!" (
            echo Downloading !filename!...
            curl -s -o "%modsDir%\!filename!" "!url!"
        ) else (
            echo !filename! already exists.
        )
    ) else (
        echo Skipping empty line.
    )
)

:: Clean up
del "%listFile%"

endlocal
