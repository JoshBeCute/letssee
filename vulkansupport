@echo off
setlocal enabledelayedexpansion

:: Define the Minecraft mods directory
set "modsDir=%appdata%\.minecraft\mods"

:: Ensure the mods directory exists
if not exist "%modsDir%" (
    mkdir "%modsDir%"
)

:: List of URLs to download from
set "listUrl1=https://raw.githubusercontent.com/JoshBeCute/letssee/main/modsplayer"
set "listUrl2=https://raw.githubusercontent.com/JoshBeCute/letssee/refs/heads/main/vulkansupportmods"

:: Function to download and process mods
for %%L in (%listUrl1% %listUrl2%) do (
    set "listFile=%temp%\mods_list_%%~nL.txt"
    curl -s -o "%listFile%" "%%L"

    :: Check if the list file was downloaded correctly
    if not exist "%listFile%" (
        exit /b 1
    )

    :: Read each line from the list file and download the corresponding file
    for /f "usebackq tokens=*" %%A in ("%listFile%") do (
        set "url=%%A"

        :: Skip empty lines
        if not "!url!"=="" (
            :: Extract filename from URL
            for /f "tokens=*" %%B in ("!url!") do set "filename=%%~nxB"

            :: Sanitize the filename
            set "sanitized="
            for /l %%i in (0,1,31) do (
                set "char=!filename:~%%i,1!"
                if "!char!" neq "" (
                    if "!char!" geq "a" if "!char!" leq "z" (
                        set "sanitized=!sanitized!!char!"
                    ) else if "!char!" geq "0" if "!char!" leq "9" (
                        set "sanitized=!sanitized!!char!"
                    )
                )
            )

            :: Ensure filename is not empty
            if "!sanitized!"=="" (
                exit /b 1
            )

            :: Append .jar extension for saving
            set "finalFilename=!sanitized!.jar"

            :: Check if the file already exists
            if not exist "%modsDir%\!finalFilename!" (
                curl -s -o "%modsDir%\!finalFilename!" "!url!"
            )
        )
    )

    :: Clean up
    del "%listFile%"
)

:: List of files to delete after downloads
set "filesToDelete=ImmediatelyFastFabricB enhancedblockentitiesB sodiumfabricbetaBmc fixantighostforkcrashj Palladiumx guardvillagersjar NetherChestedvFab ImprovedAnvilsjar gravesBjar ViaFabricPlusjar DeathFindervFabri advancednetheritefabric Terralithvjar TerraBlenderfabric"

:: Delete specified files
for %%F in (%filesToDelete%) do (
    if exist "%modsDir%\%%F.jar" (
        del "%modsDir%\%%F.jar"
    )
)

endlocal
